# ğŸ“˜ æ•°å­¦å…¬å¼æ¨å¯¼ â€”â€” åŒç›®æ ¡æ­£è¾…åŠ©å‡½æ•°è¯´æ˜

ä¸‹é¢æ ¹æ®æ¯ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œç»™å‡ºå…¶æ•°å­¦è¡¨è¾¾å½¢å¼ä¸ç‰©ç†æ„ä¹‰ã€‚

---

## â‘  `cross_product(a, b)` â€” å‘é‡å‰ä¹˜

**åŠŸèƒ½ï¼š**  
è®¡ç®—ä¸¤ä¸ªä¸‰ç»´åˆ—å‘é‡çš„å‰ä¹˜ï¼ˆå¤–ç§¯ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªå‚ç›´äºä¸¤è€…çš„å‘é‡ã€‚

**å…¬å¼ï¼š**

$$
\mathbf{c} = \mathbf{a} \times \mathbf{b} =
\begin{bmatrix}
a_y b_z - a_z b_y \\
a_z b_x - a_x b_z \\
a_x b_y - a_y b_x
\end{bmatrix}
$$

å…¶ä¸­ $\mathbf{a}, \mathbf{b}, \mathbf{c} \in \mathbb{R}^{3 \times 1}$ã€‚

---

## â‘¡ `is_rotation_matrix(R)` â€” éªŒè¯æ—‹è½¬çŸ©é˜µ

**åŠŸèƒ½ï¼š**  
åˆ¤æ–­ä¸€ä¸ªçŸ©é˜µæ˜¯å¦æ˜¯æ­£äº¤çŸ©é˜µï¼Œä¸”å…¶è¡Œåˆ—å¼ä¸º $1$ï¼Œå³æ˜¯å¦ä¸ºåˆæ³•çš„æ—‹è½¬çŸ©é˜µã€‚

**æ¡ä»¶ï¼š**
$$
R^T R = I, \quad \text{ä¸”} \quad \det(R) = 1
$$

è‹¥æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ï¼Œåˆ™ $R$ ä¸ºåˆæ³•çš„æ—‹è½¬çŸ©é˜µã€‚

---

## â‘¢ `compute_rotation_matrix(T)` â€” å¹³ç§»å‘é‡æ—‹è½¬åˆ° X è½´è´Ÿæ–¹å‘

**åŠŸèƒ½ï¼š**  
è®¡ç®—å°†å¹³ç§»å‘é‡ $\mathbf{T}$ æ—‹è½¬åˆ°ç›®æ ‡æ–¹å‘ $\mathbf{t}_{target} = [-1, 0, 0]^T$ çš„æ—‹è½¬çŸ©é˜µã€‚

### 1ï¸âƒ£ æ—‹è½¬è½´ï¼š
$$
\mathbf{u} = \frac{\mathbf{T} \times \mathbf{t}_{target}}{\|\mathbf{T} \times \mathbf{t}_{target}\|}
$$

### 2ï¸âƒ£ æ—‹è½¬è§’åº¦ï¼š
$$
\theta = \arccos\left( \frac{\mathbf{T} \cdot \mathbf{t}_{target}}{\|\mathbf{T}\| \, \|\mathbf{t}_{target}\|} \right)
$$

### 3ï¸âƒ£ ç½—å¾·é‡Œæ ¼æ–¯å…¬å¼ï¼ˆRodrigues' rotation formulaï¼‰ï¼š
$$
R = I + \sin\theta [\mathbf{u}]_{\times} + (1 - \cos\theta)[\mathbf{u}]_{\times}^2
$$

å…¶ä¸­ï¼š
$$
[\mathbf{u}]_{\times} =
\begin{bmatrix}
0 & -u_z & u_y \\
u_z & 0 & -u_x \\
-u_y & u_x & 0
\end{bmatrix}
$$

---

## â‘£ `update_intrinsic_matrix(K, cx, cy)` â€” æ›´æ–°ç›¸æœºå†…å‚çŸ©é˜µ

**åŠŸèƒ½ï¼š**  
å°†ç›¸æœºå†…å‚çŸ©é˜µçš„å…‰å¿ƒä½ç½® $(c_x, c_y)$ æ›´æ–°ä¸ºæ–°çš„åæ ‡ã€‚

**åŸå†…å‚çŸ©é˜µï¼š**
$$
K =
\begin{bmatrix}
f_x & 0 & c_x \\
0 & f_y & c_y \\
0 & 0 & 1
\end{bmatrix}
$$

**æ›´æ–°åçŸ©é˜µï¼š**
$$
K' =
\begin{bmatrix}
f_x & 0 & c_x' \\
0 & f_y & c_y' \\
0 & 0 & 1
\end{bmatrix}
$$

---

## â‘¤ `calculate_bounding_box(all_coords)` â€” è®¡ç®—äºŒç»´åæ ‡è¾¹ç•Œæ¡†

**åŠŸèƒ½ï¼š**  
è®¡ç®—æ‰€æœ‰åæ ‡ç‚¹çš„æœ€å°åŒ…å›´çŸ©å½¢ã€‚

**å…¬å¼ï¼š**
$$
x_{\min} = \min_i (x_i), \quad
x_{\max} = \max_i (x_i), \quad
y_{\min} = \min_i (y_i), \quad
y_{\max} = \max_i (y_i)
$$

---

## â‘¥ `process_camera_coordinates(image, cameraMatrix, R, newCameraMatrix)`  
â€” å›¾åƒè§’ç‚¹æŠ•å½±å˜æ¢

**åŠŸèƒ½ï¼š**  
å°†åŸå›¾åƒè§’ç‚¹åœ¨åŸç›¸æœºåæ ‡ç³»ä¸‹çš„åƒç´ åæ ‡æŠ•å½±åˆ°æ–°çš„ç›¸æœºåæ ‡ç³»ä¸­ã€‚

### 1ï¸âƒ£ åŸåƒç´ åæ ‡ï¼ˆé½æ¬¡å½¢å¼ï¼‰ï¼š
$$
\mathbf{p} = 
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
$$

### 2ï¸âƒ£ åæŠ•å½±åˆ°ç›¸æœºåæ ‡ç³»ï¼š
$$
\mathbf{X}_{cam} = K^{-1} \mathbf{p}
$$

### 3ï¸âƒ£ æ—‹è½¬åˆ°æ–°ç›¸æœºåæ ‡ç³»ï¼š
$$
\mathbf{X}'_{cam} = R \, \mathbf{X}_{cam}
$$

### 4ï¸âƒ£ æŠ•å½±åˆ°æ–°åƒç´ å¹³é¢ï¼š
$$
\mathbf{p}' = K' \, \mathbf{X}'_{cam}
$$

### 5ï¸âƒ£ é½æ¬¡å½’ä¸€åŒ–å¾—åˆ°åƒç´ åæ ‡ï¼š
$$
x' = \frac{p'_x}{p'_z}, \quad
y' = \frac{p'_y}{p'_z}
$$

---

âœ… **æ€»ç»“ï¼š**
è¿™äº›å‡½æ•°ç»„åˆæ„æˆäº†åŒç›®æ ¡æ­£çš„å‡ ä½•åŸºç¡€ï¼š
- `cross_product` ä¸ `compute_rotation_matrix` â†’ è´Ÿè´£ç©ºé—´æ–¹å‘è®¡ç®—  
- `is_rotation_matrix` â†’ ç¡®ä¿æ—‹è½¬çŸ©é˜µåˆæ³•  
- `update_intrinsic_matrix` â†’ è°ƒæ•´å…‰å¿ƒä¸æˆåƒå‚æ•°  
- `calculate_bounding_box` ä¸ `process_camera_coordinates` â†’ è®¡ç®—å˜æ¢åå›¾åƒè¾¹ç•Œä¸æŠ•å½±å…³ç³»
